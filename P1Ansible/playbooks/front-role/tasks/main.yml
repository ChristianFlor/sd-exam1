---
# tasks file for front-role
# Install nvm
- name: nvm
  shell: >
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
  args:
    creates: "{{ ansible_env.HOME }}/.nvm/nvm.sh"

# Install node 16
- name: Install node and set version
  shell: "source /root/.nvm/nvm.sh && nvm install 16.3.0"  
  args:
    executable: /bin/bash

- name: Clone a repo with separate git directory
  git:
    repo: "{{repo}}"
    dest: "{{dest}}"
    clone: yes
    version: front
    update: yes
    force: true

- name: Install packages
  npm:
   name: "install"
   path: "{{path_npm}}"

- name: build
  npm:
   name: "build"
   path: "{{path_build}}"

- name: Go to app
  become: true
  shell:   "cd /home/adminuser/app/front-app"

- name: Run start
  become: true
  shell:   "npm start"